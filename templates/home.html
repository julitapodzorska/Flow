{% extends 'base.html' %}

{% block title %}Home{% endblock %}


{% block content %}
    <p>Cześć {{ user.first_name }}!</p>
    Średnia długosc cyklu to {{ user.avg_cycle }} dni. <br>
    Twój cykl rozpoczął się {{ user.last_cycle }}
    <div class="cycle">
        <ul>
            {% for i in cycle_length %}

                {% if i == cycle_day%}
                    {% if i <= bleeding_days %}
                        <li class="today bleeding">{{ i }}</li>
                    {% else %}
                        <li class="today">{{ i }}</li>
                    {% endif %}
                {% elif i < cycle_day %}
                     {% if i <= bleeding_days %}
                        <li class="past bleeding">{{ i }}</li>
                    {% else %}
                        <li class="past">{{ i }}</li>
                    {% endif %}
                {% else %}
                    <li class="future">{{ i }}</li>
                {% endif %}


            {% endfor %}
        </ul>
    </div>
    <div class="health-form">
        {% if form %}
            <form action="" method="post">
            {% csrf_token %} 
                {{ form }}
                <input type="submit" value="Wyślij">
            </form>
        {% endif %}
    </div>
  <p><a href="{% url 'logout' %}">Wyloguj</a></p>

    <script>
        elements = document.querySelectorAll(".past, .today, .future");


        let saved_day = "0";
        for (let element of elements){
            element.onmouseenter = function () {
                saved_day = this.textContent;
                this.textContent = getDate();
            }

            element.onmouseleave = function () {
                this.textContent = saved_day;
            }
        }


        function getDate() {
            let d = new Date();
            d.setDate( d.getDate() - ({{ cycle_day }} - parseInt(saved_day)));
            let month = (d.getMonth()+1).toString().padStart(2, "0");
            let day = d.getDate().toString().padStart(2, "0");
            return (day + "." + month);
        }
    </script>
{% endblock %}


